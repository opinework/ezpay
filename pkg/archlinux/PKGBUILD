# Maintainer: Your Name <your.email@example.com>
pkgname=ezpay
pkgver=1.0.0
pkgrel=1
pkgdesc="EzPay - A lightweight payment gateway supporting USDT, WeChat and Alipay"
arch=('x86_64' 'aarch64')
url="https://github.com/yourusername/ezpay"
license=('MIT')
depends=('glibc')
makedepends=('go>=1.21')
backup=('etc/ezpay/config.yaml')
options=('!strip')
install=ezpay.install
source=()
sha256sums=()

build() {
    cd "$startdir/../.."

    export CGO_ENABLED=0
    export GOOS=linux
    export GOARCH=$(case "$CARCH" in
        x86_64) echo "amd64" ;;
        aarch64) echo "arm64" ;;
        *) echo "amd64" ;;
    esac)

    go build -ldflags="-s -w -X main.Version=${pkgver}" -o ezpay .
}

package() {
    cd "$startdir/../.."

    # Install binary
    install -Dm755 ezpay "$pkgdir/usr/bin/ezpay"

    # Install config
    install -Dm644 config.yaml "$pkgdir/etc/ezpay/config.yaml"

    # Install web files
    install -dm755 "$pkgdir/usr/share/ezpay/web"
    cp -r web/templates "$pkgdir/usr/share/ezpay/web/"
    cp -r web/static "$pkgdir/usr/share/ezpay/web/"

    # Install systemd service
    install -Dm644 "$startdir/ezpay.service" "$pkgdir/usr/lib/systemd/system/ezpay.service"

    # Create data directories
    install -dm755 "$pkgdir/var/lib/ezpay"
    install -dm755 "$pkgdir/var/log/ezpay"
}
